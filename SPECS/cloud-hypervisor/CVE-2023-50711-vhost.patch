commit 849c99eb06297d88747b551015c8e18387c11adb
Author: sindhu <lakarri@microsoft.com>
Date:   Thu Jan 18 16:55:12 2024 +0000

    Add vhost to the list of patched vendor crates

diff --git a/Cargo.toml b/Cargo.toml
index 2d9e89d..30183b6 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -55,6 +55,7 @@ kvm-bindings = { git = "https://github.com/cloud-hypervisor/kvm-bindings", branc
 kvm-ioctls = { git = "https://github.com/rust-vmm/kvm-ioctls", branch = "main" }
 versionize_derive = { git = "https://github.com/cloud-hypervisor/versionize_derive", branch = "ch" }
 vmm-sys-util = { path="vendor/vmm-sys-util/" }
+vhost = { path="vendor/vhost" }

 [dev-dependencies]
 dirs = "5.0.0"

commit 321085b2ea7bd818942be7954f3daaba1fa34293
Author: Patrick Roy <roypat@amazon.co.uk>
Date:   Tue Jan 2 11:57:50 2024 +0000

    Update vmm-sys-util to 0.12.1

    The update brings a fix for a security vulnerability behind
    feature-gated code not used by vhost (the `with-serde` feature),
    see GHSA-875g-mfp6-g7f9

    Signed-off-by: Patrick Roy <roypat@amazon.co.uk>

diff --git a/vendor/vhost/src/vhost_kern/vdpa.rs b/vendor/vhost/src/vhost_kern/vdpa.rs
index 39929c3..f2fd2f9 100644
--- a/vendor/vhost/src/vhost_kern/vdpa.rs
+++ b/vendor/vhost/src/vhost_kern/vdpa.rs
@@ -85,7 +85,10 @@ impl<AS: GuestAddressSpace> VhostVdpa for VhostKernVdpa<AS> {
         let mut config = VhostVdpaConfig::new(buffer.len())
             .map_err(|_| Error::IoctlError(IOError::from_raw_os_error(libc::ENOMEM)))?;
 
-        config.as_mut_fam_struct().off = offset;
+        // SAFETY: We are not modifying the `len` field of the vhost-vdpa fam-struct
+        unsafe {
+            config.as_mut_fam_struct().off = offset;
+        }
 
         let ret = unsafe {
             ioctl_with_ptr(
@@ -104,7 +107,10 @@ impl<AS: GuestAddressSpace> VhostVdpa for VhostKernVdpa<AS> {
         let mut config = VhostVdpaConfig::new(buffer.len())
             .map_err(|_| Error::IoctlError(IOError::from_raw_os_error(libc::ENOMEM)))?;
 
-        config.as_mut_fam_struct().off = offset;
+        // SAFETY: We are not modifying the `len` field of the vhost-vdpa fam-struct
+        unsafe {
+            config.as_mut_fam_struct().off = offset;
+        }
         config.as_mut_slice().copy_from_slice(buffer);
 
         let ret =
